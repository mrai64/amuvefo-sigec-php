# Aggiornamenti maggio 2025

Elenco degli interventi man mano che vengono fatti

## 1. Rimozione campo inutilizzato da backup

Ho rimosso scansioni_cartelle.stato_scansione, sostituito da scansioni_cartelle_stato_lavori  
ALTER TABLE `scansioni_cartelle` DROP `stato_scansione`;  
Modifiche sw: non necessarie (già fatte)
Modifiche viste: non necessarie (già fatte)
Modifiche backup: fatto (mancava)

## 2. Ricariche

Nella funzione di caricamento dettagli della fotografia, dovendo
ricaricarla decine di volte mi accollo il Ctrl-R, ma per centinaia
sorge il problema di "non posso star lì come ai remi della galera".
All'inizio della lavorazione viene testato se la fotografia manca,
viceversa ho aggiunto alla pubblicazione di inizio lavori
l'intestazione di una pagina web con il meta REFRESH tarato sui 5 secondi.
E adesso si ricarica da sola finché ha finito.

## 3. Revisione cookie

La gestione di localhost dovrebbe essere uguale a quella del sito
ma così non è. Per qualche ragione MAMP non imposta i _COOKIE come
viene fatto dal server del sito, posso fare solo ipotesi ma non ho
prove. "Speso" due giorni per decidere e rifare in 17 file la gestione
delle abilitazioni che non passano più dalla lettura diretta di $_COOKIE
ma da una funzione che  
. imposta un valore di default (lettura),  
. se è presente un valore SESSION usa quello,  
. se è presente un COOKIE usa quello e imposta il valore SESSION  
L'intervento è considerato di alto impatto, perché va a toccare
la gestione abilitazioni aprendo la porta all'amministrazione o non aprendola mai.

## 4. ricerca nome autore in nome file

Il punto 4 sarebbe stato sviluppato per rintracciare il nome autore nel nome file,
incocciando sul problema dei _cookie (mal)gestiti da MAMP.  

## 5. Correzione in cartelle-controller

Caso che non era stato testato prima: cartella inesistente, andava avanti
ma il nome della variabile per testare is_file() era usato all'interno
dell'elaborazione cartelle.

## 6. Ricarica automatica pagina di caricamento cartelle

Ho aggiunto alla pagina che in amministrazione carica dalla tabella
scansione_cartelle in tabella deposito scansioni_disco una intestazione
con auto-ricarica dopo 5 secondi, così va avanti da sola finché ha finito.

## 7. Ricarica automatica pagina caricamento Album

Come sopra per album-controller nella funzione carica_album_da_scansioni_disco().

## 4.1. Trovato nome autore, va impostato sigla autore

Lo ammetto, ho usato un trucco delle tre noci, la funzione che torna un valore
string dovrebbe invece ritornare un array di due string entrambe piene
o entrambe vuote. Sarebbe da mettere alla berlina nella categoria "SPORCA MANETTA"
e "PERCHE' / PURCHE' FUNZIONI".
Non è da me, sistemo e adesso è senza trucchi senza inganni.

## 8. Sistemazione risultati ricerca

Cambio la pagina dei risultati, l'elenco degli album e delle foto
e dei video diventa un riquadro largo, aggiungo una variabile
apposta per il contatore dei risultati di album foto video.

## 9. Modifica file javascript per indirizzo fisso

Cambiato nei file JS il richiamo ale funzioni ajax sostituendo
l'indirizzo esposto fisso e dipendente dall'installazione con una
serie di valorizzazioni che partono da window.location

## 10. Carosello /1

Insieme alla creazione della griglia foto per la vista album
ho aggiunto la creazione del codice html per visualizzare il carosello immagini
come consentito da bootstrap. 
Ancora da sistemare il fatto che la vista carosello dovrebbe alternarsi alla vista griglia.

Cambiata la pagina mostra album:
4 sezioni: fotografie, video, dettagli e carosello. Ciascuna con un bottone che gestisce la funzione "collapse" che fa sparire il contenuto e lo fa riapparire al click.
TODO: al posto della vista a 4 capitoli, provare come va l'uso delle tab 

## 11. ALTER TABLE Mysql

Nella tabella delle didascalie rimosso il "quarto" enum, vuoto. Ora *didascalie.tabella_padre*
può assumere solo i tre valori album, fotografie, video.

## 12. Aggiungi Autore

Adesso oltre a Elenco Autori (inseriti direttamente nella tabella con SQL), e a Modifica Autore, ho realizzato la pagina Aggiungi Autore
